@using Blazor.Diagrams.Core.Models
@inherits Blazor.Diagrams.Components.NodeWidget

<div class="@CssClass">
    <div class="ai-dialog-node">
        <div class="ai-node-header">
            <div class="ai-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M7.5,13A2.5,2.5 0 0,0 5,15.5A2.5,2.5 0 0,0 7.5,18A2.5,2.5 0 0,0 10,15.5A2.5,2.5 0 0,0 7.5,13M16.5,13A2.5,2.5 0 0,0 14,15.5A2.5,2.5 0 0,0 16.5,18A2.5,2.5 0 0,0 19,15.5A2.5,2.5 0 0,0 16.5,13Z"/>
                </svg>
            </div>
            <span class="ai-title">AI对话</span>
            <div class="ai-status">
                <div class="status-dot"></div>
            </div>
        </div>
        
        <div class="ai-node-body">
            <div class="ai-content">
                <div class="content-placeholder">
                    <span>点击配置AI对话</span>
                </div>
            </div>
        </div>
        
        <div class="ai-node-footer">
            <div class="node-actions">
                <button class="btn-config" @onclick="OpenConfig" @onclick:stopPropagation="true">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter] public EventCallback<NodeModel> OnConfigClick { get; set; }

    private async Task OpenConfig()
    {
        await OnConfigClick.InvokeAsync(Node);
    }
}

<style>
    .ai-dialog-node {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: 2px solid #667eea;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        min-width: 200px;
        max-width: 280px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .ai-dialog-node:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .ai-node-header {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px 8px 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .ai-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 6px;
    }

    .ai-title {
        flex: 1;
        font-size: 14px;
        font-weight: 600;
    }

    .ai-status {
        display: flex;
        align-items: center;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        background: #4CAF50;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
        }
    }

    .ai-node-body {
        padding: 12px 16px;
    }

    .ai-content {
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .content-placeholder {
        font-size: 12px;
        opacity: 0.8;
        text-align: center;
    }

    .ai-node-footer {
        padding: 8px 16px 12px 16px;
        display: flex;
        justify-content: flex-end;
    }

    .node-actions {
        display: flex;
        gap: 6px;
    }

    .btn-config {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 6px;
        padding: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        color: white;
    }

    .btn-config:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
    }
</style>